"use strict";var e=require("@solana/web3.js"),t=require("buffer"),r=require("@solana/spl-token"),o=require("bn.js"),i=require("borsh"),n=require("@ethersproject/sha2"),s=require("@pythnetwork/client"),a=require("bech32-buffer"),c=require("tweetnacl"),u=require("bs58"),p=require("ipaddr.js"),d=require("punycode");function f(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var l,y=f(c);exports.ErrorType=void 0,(l=exports.ErrorType||(exports.ErrorType={})).SymbolNotFound="SymbolNotFound",l.InvalidSubdomain="InvalidSubdomain",l.FavouriteDomainNotFound="FavouriteDomainNotFound",l.MissingParentOwner="MissingParentOwner",l.U32Overflow="U32Overflow",l.InvalidBufferLength="InvalidBufferLength",l.U64Overflow="U64Overflow",l.NoRecordData="NoRecordData",l.InvalidRecordData="InvalidRecordData",l.UnsupportedRecord="UnsupportedRecord",l.InvalidEvmAddress="InvalidEvmAddress",l.InvalidInjectiveAddress="InvalidInjectiveAddress",l.InvalidARecord="InvalidARecord",l.InvalidAAAARecord="InvalidAAAARecord",l.InvalidRecordInput="InvalidRecordInput",l.InvalidSignature="InvalidSignature",l.AccountDoesNotExist="AccountDoesNotExist",l.MultipleRegistries="MultipleRegistries",l.InvalidReverseTwitter="InvalidReverseTwitter",l.NoAccountData="NoAccountData",l.InvalidInput="InvalidInput",l.InvalidDomain="InvalidDomain",l.InvalidCustomBg="InvalidCustomBackground";class w extends Error{constructor(e,t){super(t),this.name="SNSError",this.type=e,Error.captureStackTrace&&Error.captureStackTrace(this,w)}}class g extends o{toBuffer(){const e=super.toArray().reverse(),r=t.Buffer.from(e);if(4===r.length)return r;if(r.length>4)throw new w(exports.ErrorType.U32Overflow);const i=t.Buffer.alloc(4);return r.copy(i),i}static fromBuffer(e){if(4!==e.length)throw new w(exports.ErrorType.InvalidBufferLength,`Invalid buffer length: ${e.length}`);return new o([...e].reverse().map((e=>`00${e.toString(16)}`.slice(-2))).join(""),16)}}class m extends o{toBuffer(){const e=super.toArray().reverse(),r=t.Buffer.from(e);if(8===r.length)return r;if(r.length>8)throw new w(exports.ErrorType.U64Overflow);const i=t.Buffer.alloc(8);return r.copy(i),i}static fromBuffer(e){if(8!==e.length)throw new w(exports.ErrorType.U64Overflow,`Invalid buffer length: ${e.length}`);return new o([...e].reverse().map((e=>`00${e.toString(16)}`.slice(-2))).join(""),16)}}function b(r,i,o,n,s,a,c,u,p,d,l){const f=[t.Buffer.from(Int8Array.from([0])),new g(a.length).toBuffer(),a,c.toBuffer(),u.toBuffer()],y=t.Buffer.concat(f),w=[{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1}];return p?w.push({pubkey:p,isSigner:!0,isWritable:!1}):w.push({pubkey:new e.PublicKey(t.Buffer.alloc(32)),isSigner:!1,isWritable:!1}),d?w.push({pubkey:d,isSigner:!1,isWritable:!1}):w.push({pubkey:new e.PublicKey(t.Buffer.alloc(32)),isSigner:!1,isWritable:!1}),l&&w.push({pubkey:l,isSigner:!0,isWritable:!1}),new e.TransactionInstruction({keys:w,programId:r,data:y})}function x(r,i,o,n,s){const a=[t.Buffer.from(Int8Array.from([1])),o.toBuffer(),new g(n.length).toBuffer(),n],c=t.Buffer.concat(a),u=[{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!0,isWritable:!1}];return new e.TransactionInstruction({keys:u,programId:r,data:c})}function h(r,i,o,n,s,a,c){const u=[t.Buffer.from(Int8Array.from([2])),o.toBuffer()],p=t.Buffer.concat(u),d=[{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:c||n,isSigner:!0,isWritable:!1}];return s&&d.push({pubkey:s,isSigner:!0,isWritable:!1}),c&&a&&(s||d.push({pubkey:e.PublicKey.default,isSigner:!1,isWritable:!1}),d.push({pubkey:a,isSigner:!1,isWritable:!1})),new e.TransactionInstruction({keys:d,programId:r,data:p})}function R(r,i,o,n){const s=[t.Buffer.from(Int8Array.from([3]))],a=t.Buffer.concat(s),c=[{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0}];return new e.TransactionInstruction({keys:c,programId:r,data:a})}class S{constructor(e){this.tag=9,this.name=e.name,this.space=e.space}serialize(){return i.serialize(S.schema,this)}getInstruction(i,o,n,s,a,c,u,p,d,l,f){const y=t.Buffer.from(this.serialize()),w=[{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:e.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:r.TOKEN_PROGRAM_ID,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1}];return new e.TransactionInstruction({keys:w,programId:i,data:y})}}S.schema=new Map([[S,{kind:"struct",fields:[["tag","u8"],["name","string"],["space","u32"]]}]]);class v{constructor(e){this.tag=12,this.name=e.name}serialize(){return i.serialize(v.schema,this)}getInstruction(r,i,o,n,s,a,c,u,p,d){const l=t.Buffer.from(this.serialize());let f=[];return f.push({pubkey:i,isSigner:!1,isWritable:!1}),f.push({pubkey:o,isSigner:!1,isWritable:!1}),f.push({pubkey:n,isSigner:!1,isWritable:!0}),f.push({pubkey:s,isSigner:!1,isWritable:!1}),f.push({pubkey:a,isSigner:!1,isWritable:!1}),f.push({pubkey:c,isSigner:!0,isWritable:!0}),f.push({pubkey:u,isSigner:!1,isWritable:!1}),p&&f.push({pubkey:p,isSigner:!1,isWritable:!0}),d&&f.push({pubkey:d,isSigner:!0,isWritable:!0}),new e.TransactionInstruction({keys:f,programId:r,data:l})}}v.schema=new Map([[v,{kind:"struct",fields:[["tag","u8"],["name","string"]]}]]);class A{constructor(e){this.tag=13,this.name=e.name,this.space=e.space,this.referrerIdxOpt=e.referrerIdxOpt}serialize(){return i.serialize(A.schema,this)}getInstruction(r,i,o,n,s,a,c,u,p,d,l,f,y,w,g,m,b){const x=t.Buffer.from(this.serialize());let h=[];return h.push({pubkey:i,isSigner:!1,isWritable:!1}),h.push({pubkey:o,isSigner:!1,isWritable:!1}),h.push({pubkey:n,isSigner:!1,isWritable:!0}),h.push({pubkey:s,isSigner:!1,isWritable:!0}),h.push({pubkey:a,isSigner:!1,isWritable:!1}),h.push({pubkey:c,isSigner:!1,isWritable:!1}),h.push({pubkey:u,isSigner:!0,isWritable:!0}),h.push({pubkey:p,isSigner:!1,isWritable:!0}),h.push({pubkey:d,isSigner:!1,isWritable:!1}),h.push({pubkey:l,isSigner:!1,isWritable:!1}),h.push({pubkey:f,isSigner:!1,isWritable:!1}),h.push({pubkey:y,isSigner:!1,isWritable:!0}),h.push({pubkey:w,isSigner:!1,isWritable:!1}),h.push({pubkey:g,isSigner:!1,isWritable:!1}),h.push({pubkey:m,isSigner:!1,isWritable:!1}),b&&h.push({pubkey:b,isSigner:!1,isWritable:!0}),new e.TransactionInstruction({keys:h,programId:r,data:x})}}A.schema=new Map([[A,{kind:"struct",fields:[["tag","u8"],["name","string"],["space","u32"],["referrerIdxOpt",{kind:"option",type:"u16"}]]}]]);const E=new e.PublicKey("nftD3vbNkNqfj2Sd3HZwbpw4BxxKWr4AjGb9X38JeZk"),B=t.Buffer.from("tokenized_name");var I;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.CentralState=1]="CentralState",e[e.ActiveRecord=2]="ActiveRecord",e[e.InactiveRecord=3]="InactiveRecord"}(I||(I={}));class k{constructor(t){this.tag=t.tag,this.nonce=t.nonce,this.nameAccount=new e.PublicKey(t.nameAccount),this.owner=new e.PublicKey(t.owner),this.nftMint=new e.PublicKey(t.nftMint)}static deserialize(e){return i.deserialize(this.schema,k,e)}static async retrieve(e,t){const r=await e.getAccountInfo(t);if(!r||!r.data)throw new Error("NFT record not found");return this.deserialize(r.data)}static async findKey(r,i){return await e.PublicKey.findProgramAddress([t.Buffer.from("nft_record"),r.toBuffer()],i)}}k.schema=new Map([[k,{kind:"struct",fields:[["tag","u8"],["nonce","u8"],["nameAccount",[32]],["owner",[32]],["nftMint",[32]]]}]]);const T=new e.PublicKey("namesLPneVptA9Z5rqUDD9tMTWEJwofgaYwp8cawRkX"),P="SPL Name Service",D=new e.PublicKey("58PwtjSDuFHuUkYjH9BYnnQKHfwo9reZhC2zMJv9JPkx"),N=new e.PublicKey("jCebN34bUfdeUYJT13J1yG16XWQpt5PDx6Mse9GUqhR"),K=new e.PublicKey("ETp9eKXVv1dWwHSpsXRUuXHmw24PwRkttCGVgpZEY9zF"),W=new e.PublicKey("AUoZ3YAhV3b2rZeEH93UMZHXUZcTramBvb4d9YEVySkc"),O=new e.PublicKey("33m47vH6Eav6jr5Ry86XjhRft2jRBLDnDgPSHoquXi2Z"),C=new e.PublicKey("FvPH7PrVrLGKPfqaf3xJodFTjZriqrAXXLTVWEorTFBi"),L=new e.PublicKey("4YcexoW3r78zz16J2aqmukBLRwGq6rAvWzJpkYAXqebv"),_=new e.PublicKey("DmSyHDSM9eSLyvoLsPvDr5fRRFZ7Bfr3h3ULvWpgQaq7"),M=new e.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),H=[new e.PublicKey("3ogYncmMM5CmytsGCqKHydmXmKUZ6sGWvizkzqwT7zb1"),new e.PublicKey("DM1jJCkZZEwY5tmWbgvKRxsDFzXCdbfrYCCH1CtwguEs"),new e.PublicKey("ADCp4QXFajHrhy4f43pD6GJFtQLkdBY2mjS9DfCk7tNW"),new e.PublicKey("2XTgjw8yi1E3Etgj4CUyRD7Zk49gynH2U9gA5N2MY4NP"),new e.PublicKey("5oDWj8vr3vbcq9JZTtwXqrkCMZggMsDzNietvbr1BNfe"),new e.PublicKey("8kJqxAbqbPLGLMgB6FhLcnw2SiUEavx2aEGM3WQGhtJF")],F=new Map([["EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v","USDC"],["Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB","USDT"],["So11111111111111111111111111111111111111112","SOL"],["EchesyfXePKdLtoiZSL8pBe8Myagyy8ZRqsACNCFGnvp","FIDA"],["FeGn77dhg1KXRRFeSwwMiykZnZPw5JXW6naf2aQgZDQf","ETH"],["7i5KKsX2weiTkry7jA4ZwSuXGhs5eJBEjY8vVxR4pfRx","GMT"],["AFbX8oGjGpmVFywbVouvhQSRmiW2aR1mohfahi4Y2AdB","GST"],["mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So","MSOL"],["DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263","BONK"],["EPeUFDgHRxs9xxEPVaL6kfGQvCon7jmAWKVUHuux1Tpz","BAT"]]),U=new e.PublicKey("AHtgzX45WTKfkPG53L6WYhGEXwQkN1BVknET3sVsLL8J"),z=new e.PublicKey("GcWEQ9K78FV7LEHteFVciYApERk5YvQuFDQPk1yYJVXi"),j=new e.PublicKey("BPeXUQDqGbzxeK1LJby6ugvCBuo7kRSEUkjD726mUVsz"),G=e=>{const r=P+e,i=n.sha256(t.Buffer.from(r,"utf8")).slice(2);return t.Buffer.from(i,"hex")},q=(r,i,o)=>{const n=[r];i?n.push(i.toBuffer()):n.push(t.Buffer.alloc(32)),o?n.push(o.toBuffer()):n.push(t.Buffer.alloc(32));const[s]=e.PublicKey.findProgramAddressSync(n,T);return s};async function Y(e,t){const r=G(t.toBase58()),i=q(r,O),{registry:n}=await re.retrieve(e,i);if(!n.data)throw new w(exports.ErrorType.NoAccountData);const s=new o(n.data.slice(0,4),"le").toNumber();return n.data.slice(4,4+s).toString()}async function V(e,t){let r=[];for(let i of t){const e=G(i.toBase58()),t=q(e,O);r.push(t)}return(await re.retrieveBatch(e,r)).map((e=>{if(void 0===e||void 0===e.data)return;let t=new o(e.data.slice(0,4),"le").toNumber();return e.data.slice(4,4+t).toString()}))}const X=(e,t=D)=>{let r=G(e);return{pubkey:q(r,void 0,t),hashed:r}},Z=(e,r=!1)=>{e.endsWith(".sol")&&(e=e.slice(0,-4));const i=e.split(".");if(2===i.length){const e=t.Buffer.from([r?1:0]).toString().concat(i[0]),{pubkey:o}=X(i[1]);return{...X(e,o),isSub:!0,parent:o}}if(3===i.length&&r){const{pubkey:e}=X(i[2]),{pubkey:r}=X("\0".concat(i[1]),e),o=t.Buffer.from([1]).toString();return{...X(o.concat(i[0]),r),isSub:!0,parent:e,isSubRecord:!0}}if(i.length>=3)throw new w(exports.ErrorType.InvalidInput);return{...X(e,D),isSub:!1,parent:void 0}},J=(e,t)=>{const{pubkey:r,parent:i}=Z(e),o=G(r.toBase58());return q(o,O,t?i:void 0)},Q=(e,t)=>{if(!e)throw new w(t)},$=async(t,i)=>{try{const[o]=await e.PublicKey.findProgramAddress([B,i.toBuffer()],E);if("0"===(await r.getMint(t,o)).supply.toString())return;const n=[{memcmp:{offset:0,bytes:o.toBase58()}},{memcmp:{offset:64,bytes:"2"}},{dataSize:165}],s=await t.getProgramAccounts(r.TOKEN_PROGRAM_ID,{filters:n});if(1!=s.length)return;return new e.PublicKey(s[0].account.data.slice(32,64))}catch{return}},ee=e=>[{memcmp:{offset:32,bytes:e}},{memcmp:{offset:64,bytes:"2"}}],te=async(e,t)=>{const r=await(async(e,t)=>{const r=[{memcmp:{offset:0,bytes:"3"}},{memcmp:{offset:66,bytes:t.toBase58()}}];return await e.getProgramAccounts(E,{filters:r})})(e,t.mint);if(1===r.length)return k.deserialize(r[0].account.data)};class re{constructor(t){this.parentName=new e.PublicKey(t.parentName),this.owner=new e.PublicKey(t.owner),this.class=new e.PublicKey(t.class)}static async retrieve(e,t){var r;const o=await e.getAccountInfo(t);if(!o)throw new w(exports.ErrorType.AccountDoesNotExist);let n=i.deserializeUnchecked(this.schema,re,o.data);return n.data=null===(r=o.data)||void 0===r?void 0:r.slice(this.HEADER_LEN),{registry:n,nftOwner:await $(e,t)}}static async _retrieveBatch(e,t){const r=await e.getMultipleAccountsInfo(t),o=e=>{if(!e)return;const t=i.deserializeUnchecked(this.schema,re,e);return t.data=null==e?void 0:e.slice(this.HEADER_LEN),t};return r.map((e=>o(null==e?void 0:e.data)))}static async retrieveBatch(e,t){let r=[];const i=[...t];for(;i.length>0;)r.push(...await this._retrieveBatch(e,i.splice(0,100)));return r}}async function oe(e,t){if(!await e.getAccountInfo(t))throw new w(exports.ErrorType.AccountDoesNotExist);return re.retrieve(e,t)}async function ie(e){const r=P+e,i=n.sha256(t.Buffer.from(r,"utf8")).slice(2);return t.Buffer.from(i,"hex")}async function ne(r,i,o){const n=[r];i?n.push(i.toBuffer()):n.push(t.Buffer.alloc(32)),o?n.push(o.toBuffer()):n.push(t.Buffer.alloc(32));const[s]=await e.PublicKey.findProgramAddress(n,T);return s}re.HEADER_LEN=96,re.schema=new Map([[re,{kind:"struct",fields:[["parentName",[32]],["owner",[32]],["class",[32]]]}]]);const se=async(e,t=D)=>{let r=await ie(e);return{pubkey:await ne(r,void 0,t),hashed:r}},ae=async(e,r=!1)=>{e.endsWith(".sol")&&(e=e.slice(0,-4));const i=e.split(".");if(2===i.length){const e=t.Buffer.from([r?1:0]).toString().concat(i[0]),{pubkey:o}=await se(i[1]);return{...await se(e,o),isSub:!0,parent:o}}if(3===i.length&&r){const{pubkey:e}=await se(i[2]),{pubkey:r}=await se("\0".concat(i[1]),e),o=t.Buffer.from([1]).toString();return{...await se(o.concat(i[0]),r),isSub:!0,parent:e,isSubRecord:!0}}if(i.length>=3)throw new w(exports.ErrorType.InvalidInput);return{...await se(e,D),isSub:!1,parent:void 0}};var ce;exports.Record=void 0,(ce=exports.Record||(exports.Record={})).IPFS="IPFS",ce.ARWV="ARWV",ce.SOL="SOL",ce.ETH="ETH",ce.BTC="BTC",ce.LTC="LTC",ce.DOGE="DOGE",ce.Email="email",ce.Url="url",ce.Discord="discord",ce.Github="github",ce.Reddit="reddit",ce.Twitter="twitter",ce.Telegram="telegram",ce.Pic="pic",ce.SHDW="SHDW",ce.POINT="POINT",ce.BSC="BSC",ce.Injective="INJ",ce.Backpack="backpack",ce.A="A",ce.AAAA="AAAA",ce.CNAME="CNAME",ce.TXT="TXT";const ue=new Map([[exports.Record.SOL,96],[exports.Record.ETH,20],[exports.Record.BSC,20],[exports.Record.Injective,20],[exports.Record.A,4],[exports.Record.AAAA,16]]),pe=(e,t,r)=>y.sign.detached.verify(e,t,r.toBytes()),de=(e,t)=>{const{pubkey:r}=Z(t+"."+e,!0);return r};async function fe(e,t,r,i){const o=de(t,r);let{registry:n}=await re.retrieve(e,o);if(!n.data)throw new w(exports.ErrorType.NoRecordData);if(i)return ye(n,r,o);const s=ue.get(r);return n.data=n.data.slice(0,s),n}const le=async(e,t)=>await fe(e,t,exports.Record.SOL),ye=(e,r,i)=>{const o=null==e?void 0:e.data;if(!o)return;if(0===o.compare(t.Buffer.alloc(o.length)))return;const n=ue.get(r),s=(e=>{const t=Array.from(e);return t.length-1-t.reverse().findIndex((e=>0!==e))+1})(o);if(!n)return o.slice(0,s).toString("utf-8");if(r===exports.Record.SOL){const r=new TextEncoder,n=t.Buffer.concat([o.slice(0,32),i.toBuffer()]),s=r.encode(n.toString("hex"));if(pe(s,o.slice(32,96),e.owner))return u.encode(o.slice(0,32))}if(n&&s!==n){const e=o.slice(0,s).toString("utf-8");if(r===exports.Record.Injective){const t=a.decode(e);if("inj"===t.prefix&&20===t.data.length)return e}else if(r===exports.Record.BSC||r===exports.Record.ETH){const r=e.slice(0,2),i=e.slice(2);if("0x"===r&&20===t.Buffer.from(i,"hex").length)return e}else if((r===exports.Record.A||r===exports.Record.AAAA)&&p.isValid(e))return e;throw new w(exports.ErrorType.InvalidRecordData)}if(r===exports.Record.ETH||r===exports.Record.BSC)return"0x"+o.slice(0,n).toString("hex");if(r===exports.Record.Injective)return a.encode("inj",o.slice(0,n),"bech32");if(r===exports.Record.A||r===exports.Record.AAAA)return p.fromByteArray([...o.slice(0,n)]).toString();throw new w(exports.ErrorType.InvalidRecordData)},we=(e,r)=>{if(!ue.get(r))return r!==exports.Record.CNAME&&r!==exports.Record.TXT||(e=d.encode(e)),t.Buffer.from(e,"utf-8");if(r===exports.Record.SOL)throw new w(exports.ErrorType.UnsupportedRecord,"Use `serializeSolRecord` for SOL record");if(r===exports.Record.ETH||r===exports.Record.BSC)return Q("0x"===e.slice(0,2),exports.ErrorType.InvalidEvmAddress),t.Buffer.from(e.slice(2),"hex");if(r===exports.Record.Injective){const r=a.decode(e);return Q("inj"===r.prefix,exports.ErrorType.InvalidInjectiveAddress),Q(20===r.data.length,exports.ErrorType.InvalidInjectiveAddress),t.Buffer.from(r.data)}if(r===exports.Record.A){const r=p.parse(e).toByteArray();return Q(4===r.length,exports.ErrorType.InvalidARecord),t.Buffer.from(r)}if(r===exports.Record.AAAA){const r=p.parse(e).toByteArray();return Q(16===r.length,exports.ErrorType.InvalidAAAARecord),t.Buffer.from(r)}throw new w(exports.ErrorType.InvalidRecordInput)},ge=(e,r,i,o)=>{const n=t.Buffer.concat([e.toBuffer(),r.toBuffer()]),s=(new TextEncoder).encode(n.toString("hex")),a=pe(s,o,i);return Q(a,exports.ErrorType.InvalidSignature),t.Buffer.concat([e.toBuffer(),o])};async function me(t,r,i,o,n,s,a,c){const u=await ie(r),p=await ne(u,a,c),d=s||await t.getMinimumBalanceForRentExemption(i);let l;if(c){const{registry:e}=await oe(t,c);l=e.owner}return b(T,e.SystemProgram.programId,p,n,o,u,new m(d),new g(i),a,c,l)}async function be(e,t,r,i,o){const n=await ie(t),s=await ne(n,i,o);let a;return a=i||(await re.retrieve(e,s)).registry.owner,R(T,s,r,a)}const xe=async(t,r,i,o,n)=>{let[s]=await e.PublicKey.findProgramAddress([N.toBuffer()],N),a=await ie(t.toBase58()),c=await ne(a,s,o);return[[],[new v({name:r}).getInstruction(N,T,D,c,e.SystemProgram.programId,s,i,e.SYSVAR_RENT_PUBKEY,o,n)]]},he=async(t,r,i,o,n,s)=>{Q(i!==exports.Record.SOL,exports.ErrorType.UnsupportedRecord);const{pubkey:a,hashed:c,parent:u}=Z(`${i}.${r}`,!0),p=we(o,i).length,d=await t.getMinimumBalanceForRentExemption(p+re.HEADER_LEN);return b(T,e.SystemProgram.programId,a,n,s,c,new m(d),new g(p),void 0,u,n)},Re=async(t,r,i,o,n,s)=>{const{pubkey:a,hashed:c,parent:u}=Z(`${exports.Record.SOL}.${r}`,!0),p=ge(i,a,o,n).length,d=await t.getMinimumBalanceForRentExemption(p+re.HEADER_LEN);return[b(T,e.SystemProgram.programId,a,o,s,c,new m(d),new g(p),void 0,u,o)]};class Se{constructor(e){this.twitterRegistryKey=e.twitterRegistryKey,this.twitterHandle=e.twitterHandle}static async retrieve(e,t){let r=await e.getAccountInfo(t,"processed");if(!r)throw new w(exports.ErrorType.InvalidReverseTwitter);return i.deserializeUnchecked(this.schema,Se,r.data.slice(re.HEADER_LEN))}}async function ve(r,o,n,s,a){const c=await ie(s.toString()),u=await ne(c,C,L);let p=i.serialize(Se.schema,new Se({twitterRegistryKey:n.toBytes(),twitterHandle:o}));return[b(T,e.SystemProgram.programId,u,s,a,c,new m(await r.getMinimumBalanceForRentExemption(p.length+re.HEADER_LEN)),new g(p.length),C,L,C),x(T,u,new g(0),t.Buffer.from(p),C)]}Se.schema=new Map([[Se,{kind:"struct",fields:[["twitterRegistryKey",[32]],["twitterHandle","string"]]}]]);const Ae=new e.PublicKey("85iDfUvr3HJyLM2zcq5BXSiDvUWfw6cSE1FfNBo8Ap29");class Ee{constructor(t){this.tag=t.tag,this.nameAccount=new e.PublicKey(t.nameAccount)}static deserialize(e){return i.deserialize(this.schema,Ee,e)}static async retrieve(e,t){const r=await e.getAccountInfo(t);if(!r||!r.data)throw new w(exports.ErrorType.FavouriteDomainNotFound);return this.deserialize(r.data)}static async getKey(r,i){return await e.PublicKey.findProgramAddress([t.Buffer.from("favourite_domain"),i.toBuffer()],r)}static getKeySync(r,i){return e.PublicKey.findProgramAddressSync([t.Buffer.from("favourite_domain"),i.toBuffer()],r)}}Ee.schema=new Map([[Ee,{kind:"struct",fields:[["tag","u8"],["nameAccount",[32]]]}]]),exports.CustomBg=void 0,(exports.CustomBg||(exports.CustomBg={})).DegenPoet1="DegenPoet#1";const Be=new e.PublicKey("ART5dr4bDic2sQVZoFheEmUxwQq5VGSx9he7JxHcXNQD");exports.BONFIDA_FIDA_BNB=W,exports.BONFIDA_USDC_BNB=_,exports.CUSTOM_BG_TLD=j,exports.FavouriteDomain=Ee,exports.HASH_PREFIX=P,exports.NAME_OFFERS_ID=Ae,exports.NAME_PROGRAM_ID=T,exports.NameRegistryState=re,exports.Numberu32=g,exports.Numberu64=m,exports.PYTH_FIDA_PRICE_ACC=K,exports.PYTH_MAPPING_ACC=U,exports.RECORD_V1_SIZE=ue,exports.REFERRERS=H,exports.REGISTER_PROGRAM_ID=N,exports.REVERSE_LOOKUP_CLASS=O,exports.ROOT_DOMAIN_ACCOUNT=D,exports.ReverseTwitterRegistryState=Se,exports.SNSError=w,exports.SOL_RECORD_SIG_LEN=96,exports.TOKENS_SYM_MINT=F,exports.TWITTER_ROOT_PARENT_REGISTRY_KEY=L,exports.TWITTER_VERIFICATION_AUTHORITY=C,exports.USDC_MINT=M,exports.VAULT_OWNER=z,exports.changeTwitterRegistryData=async function(e,t,r,i){const o=await ie(e),n=await ne(o,void 0,L);return[x(T,n,new g(r),i,t)]},exports.changeVerifiedPubkey=async function(e,t,r,i,o){const n=await ie(t),s=await ne(n,void 0,L);let a=[h(T,s,i,r,void 0)];const c=await ie(r.toString());return await ne(c,C,void 0),a.push(await be(e,r.toString(),o,C,L)),a=a.concat(await ve(e,t,s,i,o)),a},exports.check=Q,exports.checkSolRecord=pe,exports.createInstruction=b,exports.createInstructionV3=A,exports.createNameRegistry=me,exports.createRecordInstruction=he,exports.createReverseInstruction=v,exports.createReverseName=xe,exports.createReverseTwitterRegistry=ve,exports.createSolRecordInstruction=Re,exports.createSubdomain=async(e,t,r,i=2e3)=>{const o=[],n=t.split(".")[0];if(!n)throw new w(exports.ErrorType.InvalidSubdomain);const{parent:s,pubkey:a}=Z(t),c=await e.getMinimumBalanceForRentExemption(i+re.HEADER_LEN),u=await me(e,"\0".concat(n),i,r,r,c,void 0,s);o.push(u);const p=J(t,!0),d=await e.getAccountInfo(p);if(!(null==d?void 0:d.data)){const[,e]=await xe(a,"\0".concat(n),r,s,r);o.push(...e)}return[[],o]},exports.createV2Instruction=S,exports.createVerifiedTwitterRegistry=async function(t,r,i,o,n){const s=await ie(r),a=await ne(s,void 0,L),c=await t.getMinimumBalanceForRentExemption(o+re.HEADER_LEN);let u=[b(T,e.SystemProgram.programId,a,i,n,s,new m(c),new g(o),void 0,L,C)];return u=u.concat(await ve(t,r,a,i,n)),u},exports.deleteInstruction=R,exports.deleteNameRegistry=be,exports.deleteTwitterRegistry=async function(e,t){const r=await ie(e),i=await ne(r,void 0,L),o=await ie(t.toString()),n=await ne(o,C,L);return[R(T,i,t,t),R(T,n,t,t)]},exports.deserializeRecord=ye,exports.findSubdomains=async(e,t)=>{const r=[{memcmp:{offset:0,bytes:t.toBase58()}},{memcmp:{offset:64,bytes:O.toBase58()}}],i=await e.getProgramAccounts(T,{filters:r}),o=await Y(e,t),n=i.map((e=>{var t;return null===(t=e.account.data.slice(97).toString("utf-8"))||void 0===t?void 0:t.split("\0").join("")})),s=n.map((e=>Z(e+"."+o).pubkey)),a=await e.getMultipleAccountsInfo(s);return n.filter(((e,t)=>!!a[t]))},exports.getAllDomains=async function(e,t){const r=[{memcmp:{offset:32,bytes:t.toBase58()}},{memcmp:{offset:0,bytes:D.toBase58()}}];return(await e.getProgramAccounts(T,{filters:r})).map((e=>e.pubkey))},exports.getAllRegisteredDomains=async e=>{const t=[{memcmp:{offset:0,bytes:D.toBase58()}}];return await e.getProgramAccounts(T,{dataSlice:{offset:32,length:32},filters:t})},exports.getArtistPubkey=e=>{if(e===exports.CustomBg.DegenPoet1)return Be;throw new w(exports.ErrorType.InvalidCustomBg)},exports.getArweaveRecord=async(e,t)=>await fe(e,t,exports.Record.ARWV,!0),exports.getBackpackRecord=async(e,t)=>await fe(e,t,exports.Record.Backpack,!0),exports.getBscRecord=async(e,t)=>await fe(e,t,exports.Record.BSC,!0),exports.getBtcRecord=async(e,t)=>await fe(e,t,exports.Record.BTC,!0),exports.getCustomBgKeys=(e,t)=>{const r=G(t),i=G(e),o=q(i,void 0,j);return{domainKey:o,bgKey:q(r,void 0,o)}},exports.getDiscordRecord=async(e,t)=>await fe(e,t,exports.Record.Discord,!0),exports.getDogeRecord=async(e,t)=>await fe(e,t,exports.Record.DOGE,!0),exports.getDomainKey=ae,exports.getDomainKeySync=Z,exports.getEmailRecord=async(e,t)=>await fe(e,t,exports.Record.Email,!0),exports.getEthRecord=async(e,t)=>await fe(e,t,exports.Record.ETH,!0),exports.getFavoriteDomain=async(t,r)=>{const[i]=Ee.getKeySync(Ae,new e.PublicKey(r)),o=await Ee.retrieve(t,i),n=await Y(t,o.nameAccount);return{domain:o.nameAccount,reverse:n}},exports.getGithubRecord=async(e,t)=>await fe(e,t,exports.Record.Github,!0),exports.getHandleAndRegistryKey=async function(t,r){const i=await ie(r.toString()),o=await ne(i,C,L);let n=await Se.retrieve(t,o);return[n.twitterHandle,new e.PublicKey(n.twitterRegistryKey)]},exports.getHashedName=ie,exports.getHashedNameSync=G,exports.getInjectiveRecord=async(e,t)=>await fe(e,t,exports.Record.Injective,!0),exports.getIpfsRecord=async(e,t)=>await fe(e,t,exports.Record.IPFS,!0),exports.getLtcRecord=async(e,t)=>await fe(e,t,exports.Record.LTC,!0),exports.getNameAccountKey=ne,exports.getNameAccountKeySync=q,exports.getNameOwner=oe,exports.getPicRecord=async(e,t)=>await fe(e,t,exports.Record.Pic,!0),exports.getPointRecord=async(e,t)=>await fe(e,t,exports.Record.POINT,!0),exports.getRecord=fe,exports.getRecordKeySync=de,exports.getRecords=async function(e,t,r,i){const o=r.map((e=>de(t,e))),n=await re.retrieveBatch(e,o);return i?n.map(((e,i)=>{if(e)return ye(e,r[i],de(t,r[i]))})):n},exports.getRedditRecord=async(e,t)=>await fe(e,t,exports.Record.Reddit,!0),exports.getReverseKey=async(e,t)=>{const{pubkey:r,parent:i}=await ae(e),o=await ie(r.toBase58());return await ne(o,O,t?i:void 0)},exports.getReverseKeySync=J,exports.getShdwRecord=async(e,t)=>await fe(e,t,exports.Record.SHDW,!0),exports.getSolRecord=le,exports.getTelegramRecord=async(e,t)=>await fe(e,t,exports.Record.Telegram,!0),exports.getTokenizedDomains=async(e,t)=>{const i=await(async(e,t)=>{const i=[...ee(t.toBase58()),{dataSize:165}],o=(await e.getProgramAccounts(r.TOKEN_PROGRAM_ID,{filters:i})).map((e=>r.AccountLayout.decode(e.account.data))).map((t=>te(e,t)));return(await Promise.all(o)).filter((e=>void 0!==e))})(e,t);return(await V(e,i.map((e=>e.nameAccount)))).map(((e,t)=>({key:i[t].nameAccount,mint:i[t].nftMint,reverse:e}))).filter((e=>!!e.reverse))},exports.getTwitterHandleandRegistryKeyViaFilters=async function(t,r){const o=[{memcmp:{offset:0,bytes:L.toBase58()}},{memcmp:{offset:32,bytes:r.toBase58()}},{memcmp:{offset:64,bytes:C.toBase58()}}],n=await t.getProgramAccounts(T,{filters:o});for(const s of n)if(s.account.data.length>re.HEADER_LEN+32){let t=s.account.data.slice(re.HEADER_LEN),r=i.deserializeUnchecked(Se.schema,Se,t);return[r.twitterHandle,new e.PublicKey(r.twitterRegistryKey)]}throw new w(exports.ErrorType.AccountDoesNotExist)},exports.getTwitterRecord=async(e,t)=>await fe(e,t,exports.Record.Twitter,!0),exports.getTwitterRegistry=async function(e,t){const r=await ie(t),i=await ne(r,void 0,L),{registry:o}=await re.retrieve(e,i);return o},exports.getTwitterRegistryData=async function(r,i){const o=[{memcmp:{offset:0,bytes:L.toBase58()}},{memcmp:{offset:32,bytes:i.toBase58()}},{memcmp:{offset:64,bytes:new e.PublicKey(t.Buffer.alloc(32,0)).toBase58()}}],n=await r.getProgramAccounts(T,{filters:o});if(n.length>1)throw new w(exports.ErrorType.MultipleRegistries);return n[0].account.data.slice(re.HEADER_LEN)},exports.getTwitterRegistryKey=async function(e){const t=await ie(e);return await ne(t,void 0,L)},exports.getUrlRecord=async(e,t)=>await fe(e,t,exports.Record.Url,!0),exports.performReverseLookup=async function(e,t){const r=await ie(t.toBase58()),i=await ne(r,O),{registry:n}=await re.retrieve(e,i);if(!n.data)throw new w(exports.ErrorType.NoAccountData);const s=new o(n.data.slice(0,4),"le").toNumber();return n.data.slice(4,4+s).toString()},exports.performReverseLookupBatch=async function(e,t){let r=[];for(let i of t){const e=await ie(i.toBase58()),t=await ne(e,O);r.push(t)}return(await re.retrieveBatch(e,r)).map((e=>{if(void 0===e||void 0===e.data)return;let t=new o(e.data.slice(0,4),"le").toNumber();return e.data.slice(4,4+t).toString()}))},exports.registerDomainName=async(t,i,o,n,a,c=M,u)=>{if(i.includes(".")||i.trim().toLowerCase()!==i)throw new w(exports.ErrorType.InvalidDomain);const[p]=e.PublicKey.findProgramAddressSync([N.toBuffer()],N),d=G(i),l=q(d,void 0,D),f=G(l.toBase58()),y=q(f,p),[g]=e.PublicKey.findProgramAddressSync([l.toBuffer()],N),m=H.findIndex((e=>null==u?void 0:u.equals(e)));let b;const x=[];if(-1!==m&&u){b=r.getAssociatedTokenAddressSync(c,u,!0);const e=await t.getAccountInfo(b);if(!(null==e?void 0:e.data)){const e=r.createAssociatedTokenAccountInstruction(n,b,u,c);x.push(e)}}const h=new s.PythHttpClient(t,s.getPythProgramKeyForCluster("mainnet-beta")),R=await h.getData(),S=F.get(c.toBase58());if(!S)throw new w(exports.ErrorType.SymbolNotFound,`No symbol found for mint ${c.toBase58()}`);const v=R.productPrice.get("Crypto."+S+"/USD"),E=R.productFromSymbol.get("Crypto."+S+"/USD"),B=r.getAssociatedTokenAddressSync(c,z),I=new A({name:i,space:o,referrerIdxOpt:-1!=m?m:null}).getInstruction(N,T,D,l,y,e.SystemProgram.programId,p,n,a,U,v.productAccountKey,new e.PublicKey(E.price_account),B,r.TOKEN_PROGRAM_ID,e.SYSVAR_RENT_PUBKEY,g,b);return x.push(I),[[],x]},exports.resolve=async(r,i)=>{const{pubkey:o}=Z(i),{registry:n,nftOwner:s}=await re.retrieve(r,o);if(s)return s;try{const o=de(i,exports.Record.SOL),s=await le(r,i);if(!(null==s?void 0:s.data))throw new w(exports.ErrorType.NoRecordData);const a=new TextEncoder,c=t.Buffer.concat([s.data.slice(0,32),o.toBuffer()]),u=a.encode(c.toString("hex"));if(!pe(u,s.data.slice(32),n.owner))throw new w(exports.ErrorType.InvalidSignature);return new e.PublicKey(s.data.slice(0,32))}catch(e){if(e instanceof Error&&"FetchError"===e.name)throw e}return n.owner},exports.retrieveNftOwner=$,exports.retrieveNfts=async t=>(await t.getProgramAccounts(E,{filters:[{memcmp:{offset:0,bytes:"3"}}]})).map((t=>new e.PublicKey(t.account.data.slice(66,98)))),exports.reverseLookup=Y,exports.reverseLookupBatch=V,exports.serializeRecord=we,exports.serializeSolRecord=ge,exports.transferInstruction=h,exports.transferNameOwnership=async function(e,t,r,i,o,n){const s=await ie(t),a=await ne(s,i,o);let c;return c=i||(await re.retrieve(e,a)).registry.owner,h(T,a,r,c,i,o,n)},exports.updateInstruction=x,exports.updateNameRegistryData=async function(e,t,r,i,o,n){const s=await ie(t),a=await ne(s,o,n);let c;return c=o||(await re.retrieve(e,a)).registry.owner,x(T,a,new g(r),i,c)},exports.updateRecordInstruction=async(e,t,r,i,o,n)=>{Q(r!==exports.Record.SOL,exports.ErrorType.UnsupportedRecord);const{pubkey:s}=Z(`${r}.${t}`,!0),a=await e.getAccountInfo(s);Q(!!(null==a?void 0:a.data),exports.ErrorType.AccountDoesNotExist);const c=we(i,r);return(null==a?void 0:a.data.slice(96).length)!==c.length?[R(T,s,n,o),await he(e,t,r,i,o,n)]:[x(T,s,new g(0),c,o)]},exports.updateSolRecordInstruction=async(e,t,r,i,o,n)=>{const{pubkey:s}=Z(`${exports.Record.SOL}.${t}`,!0),a=await e.getAccountInfo(s);if(Q(!!(null==a?void 0:a.data),exports.ErrorType.AccountDoesNotExist),96!==(null==a?void 0:a.data.length))return[R(T,s,n,i),await Re(e,t,r,i,o,n)];const c=ge(r,s,i,o);return[x(T,s,new g(0),c,i)]};